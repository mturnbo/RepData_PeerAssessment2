---
title: "Storm Event Effects on Population Health and Economics (1950 - 2011)"
author: "Marcus Turnbo"
date: "November 22, 2014"
output: html_document
---

This report gives an overview of analysis of storm data from the U.S. National Oceanic and Atmospheric 
Administration (NOAA).  The data includes characteristics of major storms and weather events in the United States, 
including date and location, as well as estimates of any fatalities, injuries, and property damage.  A simple
analysis has been performed to determine events with the greatest impact in the United States.

### Data Processing 

```{r, echo=TRUE, warning=FALSE, cache=TRUE}
library(data.table)
library(plyr)
library(lubridate)

# read storm data
stormData <- (read.csv('./data/repdata-data-StormData.csv', header=TRUE))
# subset storm data in United States based on STATE value
stormDataUS <- subset(stormData, STATE %in% state.abb)

# create event year column
stormDataUS$EVENT_YEAR <- year(parse_date_time(stormDataUS$BGN_DATE, "%m/%d/%y %H%M%S"))

# create summary table
eventSummary <- data.table(ddply(stormDataUS, c('EVENT_YEAR'), summarise, 
  num.events = length(REFNUM),
  total.fatality = sum(FATALITIES),
  min.fatality = min(FATALITIES),
  max.fatality = max(FATALITIES),
  avg.fatality = mean(FATALITIES),
  total.injury = sum(INJURIES),
  min.injury = min(INJURIES),
  max.injury = max(INJURIES),
  avg.injury = mean(INJURIES),
  total.propertydamage = sum(PROPDMG),
  min.propertydamage = min(PROPDMG),
  max.propertydamage = max(PROPDMG),
  avg.propertydamage = mean(PROPDMG),
  total.cropdamage = sum(PROPDMG),
  min.cropdamage = min(CROPDMG),
  max.cropdamage = max(CROPDMG),
  avg.cropdamage = mean(CROPDMG)
))
setnames(eventSummary, names(eventSummary)[1], c('event.year'))

# find earliest years where data exists
earliestFatalityYear <- min(eventSummary[which(eventSummary$max.fatality > 0), EVENT_YEAR])
earliestInjuryYear <- min(eventSummary[which(eventSummary$max.injury > 0), EVENT_YEAR])
earliestPropertyDamageYear <- min(eventSummary[which(eventSummary$max.propertydamage > 0), EVENT_YEAR])
earliestCropDamageYear <- min(eventSummary[which(eventSummary$max.cropdamage > 0), EVENT_YEAR])
```

`r nrow(stormData)` observations were found in the downloaded data.
- The downloaded data includes events from `r min(eventSummary$EVENT_YEAR)` through `r max(eventSummary$EVENT_YEAR)`. 
- The earliest fatality data is in `r earliestFatalityYear`
- The earliest injury data is in `r earliestInjuryYear`
- The earliest property damage data is in `r earliestPropertyDamageYear`
- The earliest crop damage data is in `r earliestPropertyDamageYear`

### Results

#### The most harmful events across the United States with respect to population health:

```{r, echo=TRUE}
eventImpactPopulationHealth <- subset(ddply(stormDataUS, c('EVTYPE'), summarise, 
  total.fatality = sum(FATALITIES),
  avg.fatality = mean(FATALITIES),
  total.injury = sum(INJURIES),
  avgInjury = mean(INJURIES)
), total.fatality > 0 | total.injury > 0)
summary(eventImpactPopulationHealth)
```

#### Events across the United States with the greatest economic consequences:
```{r, echo=TRUE}
eventImpactDamage <- subset(ddply(stormDataUS, c('EVTYPE'), summarise, 
  total.property = sum(PROPDMG),
  avg.Property = mean(PROPDMG),
  total.crop = sum(CROPDMG),
  avg.crop = mean(CROPDMG)
), total.property > 0 | total.crop > 0)
summary(eventImpactDamage)
```
